{% extends "layout/base.html" %}

{% block title %}매매 내역 분석{% endblock %}

{% block head_css %}
<style>
    .filter-container {
        display: flex;
        gap: 15px;
        align-items: center;
        margin-bottom: 20px;
    }
    .kpi-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
    }
    .kpi-card {
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        text-align: center;
    }
    .kpi-card .value {
        font-size: 1.8em;
        font-weight: bold;
    }
    .kpi-card .label {
        font-size: 0.9em;
        color: #777;
        margin-top: 5px;
    }
    .chart-container-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
    }
</style>
{% endblock %}

{% block content %}
<h2>📊 매매 내역 분석</h2>

<div class="panel">
    <h3>조회 조건</h3>
    <div class="filter-container">
        <label for="start_date">시작일:</label>
        <input type="date" id="start_date" name="start_date" value="2025-07-01">
        <label for="end_date">종료일:</label>
        <input type="date" id="end_date" name="end_date" value="2025-08-01">
        <button class="btn-primary" style="padding: 8px 15px;">조회</button>
    </div>
</div>

<div class="kpi-grid" style="margin-top: 20px;">
    <div class="kpi-card">
        <div class="value text-green">+ 2,530,000 원</div>
        <div class="label">총 실현 손익</div>
    </div>
    <div class="kpi-card">
        <div class="value">152 회</div>
        <div class="label">총 매매 횟수</div>
    </div>
    <div class="kpi-card">
        <div class="value text-green">68.4 %</div>
        <div class="label">승률</div>
    </div>
    <div class="kpi-card">
        <div class="value">1.85</div>
        <div class="label">평균 손익비</div>
    </div>
</div>

<div class="chart-container-grid">
    <div class="panel">
        <h3>월별 손익</h3>
        <canvas id="monthlyProfitChart"></canvas>
    </div>
    <div class="panel">
        <h3>수익/손실 거래</h3>
        <canvas id="winLossPieChart"></canvas>
    </div>
</div>

<div class="panel">
    <h3>상세 매매 내역</h3>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>매도일자</th>
                    <th>종목명</th>
                    <th class="align-right">매수금액</th>
                    <th class="align-right">매도금액</th>
                    <th class="align-right">실현손익</th>
                    <th class="align-right">수익률(%)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>2025-08-01</td>
                    <td>삼성전자</td>
                    <td class="align-right">9,010,000</td>
                    <td class="align-right">9,150,000</td>
                    <td class="align-right text-green">+140,000</td>
                    <td class="align-right text-green">+1.55%</td>
                </tr>
                 <tr>
                    <td>2025-07-30</td>
                    <td>LG에너지솔루션</td>
                    <td class="align-right">4,500,000</td>
                    <td class="align-right">4,410,000</td>
                    <td class="align-right text-red">-90,000</td>
                    <td class="align-right text-red">-2.00%</td>
                </tr>
                <tr>
                    <td>2025-07-28</td>
                    <td>하이브</td>
                    <td class="align-right">2,050,000</td>
                    <td class="align-right">2,180,000</td>
                    <td class="align-right text-green">+130,000</td>
                    <td class="align-right text-green">+6.34%</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // 이 페이지의 차트를 그리기 위한 Javascript 코드
    // 실제로는 조회 버튼 클릭 시 API를 호출하여 데이터를 받아온 후 차트를 렌더링합니다.
    document.addEventListener('DOMContentLoaded', () => {
        // 월별 손익 바 차트 (예시)
        const ctxBar = document.getElementById('monthlyProfitChart').getContext('2d');
        new Chart(ctxBar, {
            type: 'bar',
            data: {
                labels: ['6월', '7월', '8월'],
                datasets: [{
                    label: '월별 실현 손익 (원)',
                    data: [1200000, 2530000, 850000],
                    backgroundColor: ['#3498db', '#2ecc71', '#e74c3c'],
                }]
            }
        });

        // 승률 파이 차트 (예시)
        const ctxPie = document.getElementById('winLossPieChart').getContext('2d');
        new Chart(ctxPie, {
            type: 'pie',
            data: {
                labels: ['수익 거래', '손실 거래'],
                datasets: [{
                    data: [104, 48], // 152회 매매 중 104회 수익
                    backgroundColor: ['#2ecc71', '#e74c3c'],
                }]
            }
        });
    });
</script>
{% endblock %}